---
title: "Raw Data Visualization"
output: html_document
date: "2024-11-23"
---
This document will walk through some initial plots of raw data

# Data Background:
There are 10 dataframes that will be used in this process, which are created in the source file "01_Data_Imput"
Two dataframes hold weekly data from 1982 - 2024, two hold imputed weekly data from 1982 - 2024, two that hold the weekly data that is trimmed to 2014 - 2023, two that hold the imputed data from 2014 - 2023, and two hold daily data from 2014 - 2023.
There are two of each of these dataframes because one is trimmed to only include April 1 - July 15 each year, and the other is un-trimmed. Models will be built with the trimmed data in order for the relationship between flow and ice presence to be correct.
Training models will be built using data from 2014-2023, these are the years in which in-situ ice observations are available.
```{r echo = FALSE}
# load libraries
library(pacman)
p_load(dplyr,dataRetrieval,lubridate,tidyr,ggplot2,viridis,readxl,imputeTS,tsibble,sjPlot,pROC,gridExtra,broom,gtsummary,patchwork)
# This is the file that combines and cleans data:
source("Input_Files/01_Data_Input.R")

# Un-comment a dataframe to view:
## these three are the un-trimmed data
#daily:
#View(flow_temp_cond_daily_ice)
# weekly:
#View(flow_temp_cond_weekly_ice)
# weekly imputed:
#View(flow_temp_cond_imputed_ice)

## these are the trimmed data:
# daily:
#View(daily_data_trimmed)
# weekly:
#View(weekly_data_trimmed)
# weekly imputed:
#View(imputed_data_trimmed)

# weekly trimmed for 2014-2023:
#View(flow_temp_cond_weekly_ice_14_23)
# weekly trimmed 2014-2023 and trimmed for spring:
#View(weekly_data_trimmed_14_23)
# weekly imputed trimmed for 2014-2023
#View(flow_temp_cond_imputed_ice_14_23)
# weekly imputed trimmed for 2014-2023 and trimmed for spring:
#View(imputed_data_trimmed_14_23)
```
# Visualizations:
Let's look at some of the raw data:

First, let's look at the observed dates of ice-off by year (±6 days) obtained from photos taken by field crews:
```{r}
obs_ice_off_plot <- ggplot(obs_ice_off_dates, aes(x = waterYear, y = wy_doy_ice_off)) +
  geom_point() +
  scale_x_continuous(
    breaks = seq(min(obs_ice_off_dates$waterYear), max(obs_ice_off_dates$waterYear), by = 1))+
  labs(
    x = "Year",
    y = "Water Year DOY of Ice-Off (± 6d)")
obs_ice_off_plot
#ggsave("Figures/observed_ice_off_dates.png", dpi=600, width=6, height=4, units="in")
```

Here's a low-resolution look at the cumulative flow for each year in which we have in-situ ice observations. Visually, between the water year day of year 200 - 250, flow usually begins to increase.
```{r echo=FALSE}
ggplot(flow_temp_cond_daily_ice %>% filter(waterYear >= 2014 & waterYear < 2024), aes(x = wy_doy, y = cumulative_dis))+
  geom_line(color="darkturquoise") +
  lims(x=c(200,270),y=c(20,1000))+# Use geom_point() if you prefer points instead of lines
  facet_wrap(~ waterYear) +  # Creates a separate plot for each water year
  labs(
    x = "Water Year Day of Year",
    y = "Cumulative Discharge") 
#ggsave("Figures/cumulative_discharge_allYears.png", dpi=600, width=6, height=4, units="in")
```
# Cumalitve Discharge
Now let's take a closer look at each year and compare the cumulative discharge to ice observations - the shaded area of each plot represents the observed time of ice beginning to melt to when there is 0 ice on The Loch.

Visually, the variability in each year is not too high, but probably high enough that a model only using cumulative discharge would not be accurate for predicting ice-off.
## 2014
```{r echo = FALSE}
# water year 2014
ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2014),
  aes(x = wy_doy, y = cumulative_dis, group = waterYear)) +
  # geom_rect(aes(xmin=205,xmax=247,ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  geom_rect(aes(xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2014], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2014], ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  theme_dark() +
  geom_line() +
  lims(x = c(200, 260), y = c(150, 750))+
  labs(x = "Date", y = "Cumulative Discharge (cfs)")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))
```
## 2015
```{r echo = FALSE}
# water year 2015:
ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2015),
  aes(x = wy_doy, y = cumulative_dis, group = waterYear)) +
  # geom_rect(aes(xmin=197,xmax=239,ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  geom_rect(aes(xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2015], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2015], ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  theme_dark() +
  geom_line() +
  lims(x = c(180, 260), y = c(130, 600))+
  labs(x = "Water Year Day of Year (2015)", y = "Cumulative Discharge (cfs)")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))
ggsave("Figures/2015_discharge_with_window.png",width=6, height=4, units="in")
```
## 2016
```{r echo = FALSE}
# water year 2016:
ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2016),
  aes(x = wy_doy, y = cumulative_dis, group = waterYear)) +
  # geom_rect(aes(xmin=195,xmax=251,ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  geom_rect(aes(xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2016], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2016], ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  theme_dark() +
  geom_line() +
  lims(x = c(180, 260), y = c(50, 700))+
  labs(x = "Water Year Day of Year (2016)", y = "Cumulative Discharge (cfs)")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))
```
## 2017
```{r echo = FALSE}
# water year 2017:
ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2017),
  aes(x = wy_doy, y = cumulative_dis, group = waterYear)) +
  # geom_rect(aes(xmin=173,xmax=243,ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  geom_rect(aes(xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2017], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2017], ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  theme_dark() +
  geom_line() +
  lims(x = c(170, 255), y = c(50, 600))+
  labs(x = "Water Year Day of Year (2017)", y = "Cumulative Discharge (cfs)")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))
```
## 2018
```{r echo = FALSE}
# water year 2018:
ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2018),
  aes(x = wy_doy, y = cumulative_dis, group = waterYear)) +
  # geom_rect(aes(xmin=214,xmax=235,ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  geom_rect(aes(xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2018], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2018], ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  theme_dark() +
  geom_line() +
  lims(x = c(210, 240), y = c(180, 750))+
  labs(x = "Water Year Day of Year (2018)", y = "Cumulative Discharge (cfs)")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))
```
## 2019
```{r echo = FALSE}
# water year 2019:
ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2019),
  aes(x = wy_doy, y = cumulative_dis, group = waterYear)) +
  # geom_rect(aes(xmin=206,xmax=260,ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  geom_rect(aes(xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2019], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2019], ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  theme_dark() +
  geom_line() +
  lims(x = c(200, 270), y = c(180, 1000))+
  labs(x = "Water Year Day of Year (2019)", y = "Cumulative Discharge (cfs)")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))
```
## 2020
```{r echo=FALSE}
# water year 2020:
ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2020),
  aes(x = wy_doy, y = cumulative_dis, group = waterYear)) +
  # geom_rect(aes(xmin=211,xmax=234,ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  geom_rect(aes(xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2020], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2020], ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  theme_dark() +
  geom_line() +
  lims(x = c(200, 250), y = c(50, 450))+
  labs(x = "Water Year Day of Year (2020)", y = "Cumulative Discharge (cfs)")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))
```
## 2021
```{r echo=FALSE}
# water year 2021
ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2021),
  aes(x = wy_doy, y = cumulative_dis, group = waterYear)) +
  # geom_rect(aes(xmin=210,xmax=255,ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  geom_rect(aes(xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2021], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2021], ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  theme_dark() +
  geom_line() +
  lims(x = c(200, 270), y = c(50, 900))+
  labs(x = "Water Year Day of Year (2021)", y = "Cumulative Discharge (cfs)")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))
```
## 2022
```{r echo=FALSE}
# water year 2022
ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2022),
  aes(x = wy_doy, y = cumulative_dis, group = waterYear)) +
  # geom_rect(aes(xmin=216,xmax=244,ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  geom_rect(aes(xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2022], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2022], ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  theme_dark() +
  geom_line() +
  lims(x = c(200, 250), y = c(50, 450))+
  labs(x = "Water Year Day of Year (2022)", y = "Cumulative Discharge (cfs)")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))
```
## 2023
```{r echo=FALSE}
# water year 2023:
ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2023),
  aes(x = wy_doy, y = cumulative_dis, group = waterYear)) +
  # geom_rect(aes(xmin=215,xmax=243,ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  geom_rect(aes(xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2023], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2023], ymin=-Inf,ymax=Inf), fill="lightblue",alpha=0.01)+
  theme_dark() +
  geom_line() +
  lims(x = c(205, 250), y = c(70, 600))+
  labs(x = "Water Year Day of Year (2023)", y = "Cumulative Discharge (cfs)")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))
```
Now let's look at the daily observations of temperature and conductivity by year compared to the date of 0 ice on The Loch (represented by a vertical black line).
# Temp and Cond
Visually, temperature and conductivity seem to have less variation year-to-year.
```{r}
# making a long format dataframe to visualize the two variables together.
out_condTempDaily_long <- pivot_longer(out_cond_temp_daily, -c(Date,wy_doy,waterYear), names_to="hydro_variables", values_to = "temp_or_cond") %>% mutate(waterYear = calcWaterYear(Date)) %>% mutate(Date = as.Date(Date, tz = "MST", format = "%Y-%m-%d"))%>% mutate(wy_doy = hydro.day(Date))
```
Every year:
```{r}

ggplot(out_condTempDaily_long %>% filter(waterYear >= 2014 & waterYear <=2023), aes(wy_doy,temp_or_cond, group = waterYear, col = hydro_variables)) + geom_point(size = 0.5) + lims(x=c(180,270))+labs(x = "Water Year Day of Year", y = "Temperature (C), Conductivity (uS/cm)")+facet_wrap(~ waterYear)

ggsave("Figures/temp&cond_allYears.png", dpi=600, width=6, height=4, units="in")

```
## 2014
```{r echo=FALSE}
# water year 2014
ggplot(out_condTempDaily_long %>% filter(waterYear==2014), aes(wy_doy,temp_or_cond, group = waterYear, col = hydro_variables)) + geom_point(size = 0.5) + labs(x = "Water Year Day of Year (2014)", y = "Temperature (C), Conductivity (uS/cm)")+ geom_vline(xintercept = obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2014]) # ice off date
```
## 2015
```{r echo=FALSE}
# water year 2015
ggplot(out_condTempDaily_long %>% filter(waterYear==2015), aes(wy_doy,temp_or_cond, group = waterYear, col = hydro_variables)) + geom_point(size = 0.5) + labs(x = "Water Year Day of Year (2015)", y = "Temperature (C), Conductivity (uS/cm)") + geom_vline(xintercept = obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2015]) + lims(x=c(190,250),y=c(-1,10)) # ice off date
ggsave("Figures/2015_tempCond_with_window.png",width=6, height=4, units="in")
```
## 2016
```{r echo=FALSE}
# water year 2016
ggplot(out_condTempDaily_long %>% filter(waterYear==2016), aes(wy_doy,temp_or_cond, group = waterYear, col = hydro_variables)) + geom_point(size = 0.5) + labs(x = "Water Year Day of Year (2016)", y = "Temperature (C), Conductivity (uS/cm)")+ geom_vline(xintercept = obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2016]) # ice off date
```
## 2017
```{r echo=FALSE}
# water year 2017
ggplot(out_condTempDaily_long %>% filter(waterYear==2017), aes(wy_doy,temp_or_cond, group = waterYear, col = hydro_variables)) + geom_point(size = 0.5) + labs(x = "Water Year Day of Year (2017)", y = "Temperature (C), Conductivity (uS/cm)")+ geom_vline(xintercept = obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2017]) # ice off date
```
## 2018
```{r echo=FALSE}
# water year 2018
ggplot(out_condTempDaily_long %>% filter(waterYear==2018), aes(wy_doy,temp_or_cond, group = waterYear, col = hydro_variables)) + geom_point(size = 0.5) + labs(x = "Water Year Day of Year (2018)", y = "Temperature (C), Conductivity (uS/cm)")+ geom_vline(xintercept = obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2018]) # ice off date
```
## 2019
```{r echo=FALSE}
# water year 2019
ggplot(out_condTempDaily_long %>% filter(waterYear==2019), aes(wy_doy,temp_or_cond, group = waterYear, col = hydro_variables)) + geom_point(size = 0.5) + labs(x = "Water Year Day of Year (2019)", y = "Temperature (C), Conductivity (uS/cm)")+ geom_vline(xintercept = obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2019]) # ice off date
```
## 2020
```{r echo=FALSE}
# water year 2020
ggplot(out_condTempDaily_long %>% filter(waterYear==2020), aes(wy_doy,temp_or_cond, group = waterYear, col = hydro_variables)) + geom_point(size = 0.5) + labs(x = "Water Year Day of Year (2020)", y = "Temperature (C), Conductivity (uS/cm)")+ geom_vline(xintercept = obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2020]) # ice off date
```
## 2021
```{r echo=FALSE}
# water year 2021
ggplot(out_condTempDaily_long %>% filter(waterYear==2021), aes(wy_doy,temp_or_cond, group = waterYear, col = hydro_variables)) + geom_point(size = 0.5) + labs(x = "Water Year Day of Year (2021)", y = "Temperature (C), Conductivity (uS/cm)")+ geom_vline(xintercept = obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2021]) # ice off date
```
## 2022
```{r echo=FALSE}
# water year 2022
ggplot(out_condTempDaily_long %>% filter(waterYear==2022), aes(wy_doy,temp_or_cond, group = waterYear, col = hydro_variables)) + geom_point(size = 0.5) + labs(x = "Water Year Day of Year (2022)", y = "Temperature (C), Conductivity (uS/cm)")+ geom_vline(xintercept = obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2022]) # ice off date
```
## 2023
```{r echo=FALSE}
# water year 2023
ggplot(out_condTempDaily_long %>% filter(waterYear==2023), aes(wy_doy,temp_or_cond, group = waterYear, col = hydro_variables)) + geom_point(size = 0.5) + labs(x = "Water Year Day of Year (2023)", y = "Temperature (C), Conductivity (uS/cm)")+ geom_vline(xintercept = obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2023]) # ice off date
```
# Pretty Plots:
## CQ, Temp
```{r}
# plots for temperature and discharge (change the x variable and limits)
labels_x<-c(212,217,222,227,232,237,242)

labels_y_cq<-c(176.573,353.147,529.72,706.293)
#5,10,15,20

# April 30 (212) to June 1 (244) for buoy plot below
# labels: April 30: 212, May 5: 217, May 10: 222, May 15: 227, May 20: 232, May 25: 237, May 30: 242

outTempPlot <- ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2018),
  aes(x = wy_doy, y = Temperature_C, group = waterYear)) +
  theme_bw() +
  geom_line(size=1) +
  geom_point(aes(x = wy_doy, y = Temperature_C, group = waterYear),size=1.5)+
  geom_vline(xintercept=pierson_dates$wy_doy_pierson_off[pierson_dates$waterYear==2018],color="#5D3A9B",size=1)+ # pierson ice-off
  lims(x = c(209, 244), y = c(0, 10))+
  theme(axis.title.x = element_blank())+
  labs(y = "Temperature (C)")+
  scale_x_continuous(breaks=labels_x,labels=c("Apr-30","May-05","May-10","May-15","May-20", "May-25","May-30"),limits=c(209,244))+
  annotate('rect', xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2018], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2018], ymin=-Inf, ymax=Inf, alpha=0.4, fill='lightblue')

outCQPlot <- ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2018),
  aes(x = wy_doy, y = cumulative_dis, group = waterYear)) +
  theme_bw() +
  geom_line(size=1) +
  geom_point(aes(x = wy_doy, y = cumulative_dis, group = waterYear),size=1.5)+
  geom_vline(xintercept=pierson_dates$wy_doy_pierson_off[pierson_dates$waterYear==2018],color="#5D3A9B",size=1)+ # pierson ice-off
  lims(x = c(209, 244), y = c(100, 750))+
  labs(x="Date", y = "Cumulative Discharge (cms)")+
  scale_y_continuous(breaks=labels_y_cq,labels=c("5","10","15","20"),limits=c(100,750))+
  scale_x_continuous(breaks=labels_x,labels=c("Apr-30","May-05","May-10","May-15","May-20", "May-25","May-30"),limits=c(209,244))+
  annotate('rect', xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2018], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2018], ymin=-Inf, ymax=Inf, alpha=0.4, fill='lightblue')

outTempPlot
outCQPlot # make sure this is on the bottom of the stack because it has the x-axis label
```
## Buoy
```{r}
miniDot <- read.csv("Input_Files/loch_minidot_WY2017-2024.csv")

miniDot <- miniDot %>% mutate(Depth_m = as.character(depth))

miniDot <- miniDot %>% mutate(date_time = ymd_hms(date_time))


#labels_x_1<-c(())

buoyPlot <- ggplot(
  miniDot %>% filter(date_time > "2018-04-27" & date_time < "2018-06-01"),
  aes(x = date_time, y = temp, color = Depth_m,group = Depth_m))+
  theme_bw()+
  geom_vline(xintercept=as_datetime("2018-05-21 01:39:00"),color="#5D3A9B",size=1)+ # pierson ice-off
  geom_point(size=0.8,)+
  geom_line(aes(x = date_time, y = temp, color = Depth_m,group = Depth_m))+
  scale_color_manual(values = c("#1A85FF", "#D41159"))+
  labs(y="Temperature (C)")+
  theme(axis.title.x = element_blank()) +
  scale_x_datetime(date_labels = "%b-%d", breaks = "5 days")+
  annotate('rect', xmin=as_datetime("2018-05-01 01:39:00"), xmax=as_datetime("2018-05-22 01:39:00"), ymin=-Inf, ymax=Inf, alpha=0.4, fill='lightblue')
buoyPlot
```
###  Buoy, Temp, CQ
```{r}
buoyTempCQPlot <- buoyPlot / outTempPlot / outCQPlot + plot_layout(heights = c(20,20,20))
buoyTempCQPlot
#ggsave("Figures/buoyOutPlot.png", dpi=600, width=6, height=8, units="in")
```
## Outlet and Probability of No Ice:
```{r}
# Bring in hindcasted ice-off dates:
hindcasted_dates <- read.csv("Input_Files/hindcasted_ice_off_dates.csv") %>% select(-"X")

# plots for temperature and discharge (change the x variable and limits)
labels_x<-c(212,217,222,227,232,237,242)

labels_y_cq<-c(176.573,353.147,529.72,706.293)
#5,10,15,20

# April 30 (212) to June 1 (244) for buoy plot below
# labels: April 30: 212, May 5: 217, May 10: 222, May 15: 227, May 20: 232, May 25: 237, May 30: 242

outTempPlot_preddate <- ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2018),
  aes(x = wy_doy, y = Temperature_C, group = waterYear)) +
  theme_bw() +
  geom_line(size=1) +
  geom_point(aes(x = wy_doy, y = Temperature_C, group = waterYear),size=1.5)+
  geom_vline(xintercept=pierson_dates$wy_doy_pierson_off[pierson_dates$waterYear==2019],color="#5D3A9B",size=1)+ # pierson ice-off
  geom_vline(xintercept=hindcasted_dates$first_no_ice_wy_doy[hindcasted_dates$waterYear==2018],color="#E66100",size=1)+ # hindcasted ice-off
  lims(x = c(209, 244), y = c(0, 10))+
  theme(axis.title.x = element_blank())+
  labs(y = "Temperature (C)")+
  scale_x_continuous(breaks=labels_x,labels=c("Apr-30","May-05","May-10","May-15","May-20", "May-25","May-30"),limits=c(209,244))+
  annotate('rect', xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2019], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2018], ymin=-Inf, ymax=Inf, alpha=0.4, fill='lightblue')

outCQPlot_preddate <- ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2018),
  aes(x = wy_doy, y = cumulative_dis, group = waterYear)) +
  theme_bw() +
  geom_line(size=1) +
  geom_point(aes(x = wy_doy, y = cumulative_dis, group = waterYear),size=1.5)+
  geom_vline(xintercept=pierson_dates$wy_doy_pierson_off[pierson_dates$waterYear==2018],color="#5D3A9B",size=1)+ # pierson ice-off
  geom_vline(xintercept=hindcasted_dates$first_no_ice_wy_doy[hindcasted_dates$waterYear==2018],color="#E66100",size=1)+
  lims(x = c(209, 244), y = c(100, 750))+
  labs(x="Date", y = "Cumulative Discharge (cms)")+
  scale_y_continuous(breaks=labels_y_cq,labels=c("5","10","15","20"),limits=c(100,750))+
  scale_x_continuous(breaks=labels_x,labels=c("Apr-30","May-05","May-10","May-15","May-20", "May-25","May-30"),limits=c(209,244))+
  annotate('rect', xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2018], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2018], ymin=-Inf, ymax=Inf, alpha=0.4, fill='lightblue')

outTempPlot_preddate
outCQPlot_preddate
```



```{r}
probIcePlot <- ggplot(imputed_data_trimmed_prob %>% filter(waterYear == 2018), aes(x = wy_doy, y = ice_probability)) +
  geom_line(size=1) +
  geom_point(aes(x = wy_doy, y = ice_probability),size=1.5)+
  geom_vline(xintercept=pierson_dates$wy_doy_pierson_off[pierson_dates$waterYear==2018],color="#5D3A9B",size=1)+ # pierson ice-off
  geom_hline(yintercept=0.5,linetype=2)+
  labs(y = "Probability of No Ice"
  )+ lims(x = c(209,244))+
  theme_bw()+
  theme(axis.title.x = element_blank()) +
  scale_x_continuous(breaks=labels_x,labels=c("Apr-30","May-05","May-10","May-15","May-20", "May-25","May-30"),limits=c(209,244))+
  annotate('rect', xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2018], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2018], ymin=-Inf, ymax=Inf, alpha=0.4, fill='lightblue')

probIcePlot

probTempCQPlot <- probIcePlot / outTempPlot_preddate / outCQPlot_preddate + plot_layout(heights = c(20,20,20))
probTempCQPlot
#ggsave("Figures/probOutPlot.png", dpi=600, width=6, height=8, units="in")
```
# Stacked plots for every year in observed:
## Getting started:
```{r}
# plots for temperature and discharge (change the x variable and limits)
labels_x<-c(172,182,192,202,212,222,232,242,252)

labels_y_cq<-c(176.573,353.147,529.72,706.293)
#5,10,15,20

# April 30 (212) to June 1 (244) for buoy plot below
# labels: April 30: 212, May 5: 217, May 10: 222, May 15: 227, May 20: 232, May 25: 237, May 30: 242

outTempPlot_preddate <- ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2017),
  aes(x = wy_doy, y = Temperature_C, group = waterYear)) +
  theme_bw() +
  geom_line(size=1) +
  geom_point(aes(x = wy_doy, y = Temperature_C, group = waterYear),size=1.5)+
  geom_vline(xintercept=pierson_dates$wy_doy_pierson_off[pierson_dates$waterYear==2017],color="#5D3A9B",size=1)+ # pierson ice-off
  geom_vline(xintercept=hindcasted_dates$first_no_ice_wy_doy[hindcasted_dates$waterYear==2017],color="#E66100",size=1)+ # hindcasted ice-off
  lims(x = c(170, 255), y = c(0, 10))+
  theme(axis.title.x = element_blank())+
  labs(y = "Temperature (C)")+
  scale_x_continuous(breaks=labels_x,labels=c("Mar-21","Mar-31","Apr-10","Apr-20","Apr-30","May-10","May-20","May-30","Jun-09"),limits=c(170,255))+
  annotate('rect', xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2017], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2017], ymin=-Inf, ymax=Inf, alpha=0.4, fill='lightblue')

outCQPlot_preddate <- ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2017),
  aes(x = wy_doy, y = cumulative_dis, group = waterYear)) +
  theme_bw() +
  geom_line(size=1) +
  geom_point(aes(x = wy_doy, y = cumulative_dis, group = waterYear),size=1.5)+
  geom_vline(xintercept=pierson_dates$wy_doy_pierson_off[pierson_dates$waterYear==2017],color="#5D3A9B",size=1)+ # pierson ice-off
  geom_vline(xintercept=hindcasted_dates$first_no_ice_wy_doy[hindcasted_dates$waterYear==2017],color="#E66100",size=1)+
  lims(x = c(170, 255), y = c(50, 750))+
  labs(x="Date", y = "Cumulative Discharge (cms)")+
  scale_y_continuous(breaks=labels_y_cq,labels=c("5","10","15","20"),limits=c(50,750))+
  scale_x_continuous(breaks=labels_x,labels=c("Mar-21","Mar-31","Apr-10","Apr-20","Apr-30","May-10","May-20","May-30","Jun-09"),limits=c(170,255))+
  annotate('rect', xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2017], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2017], ymin=-Inf, ymax=Inf, alpha=0.4, fill='lightblue')

outTempPlot_preddate
outCQPlot_preddate


probIcePlot <- ggplot(imputed_data_trimmed_prob %>% filter(waterYear == 2017), aes(x = wy_doy, y = ice_probability)) +
  geom_line(size=1) +
  geom_point(aes(x = wy_doy, y = ice_probability),size=1.5)+
  geom_vline(xintercept=pierson_dates$wy_doy_pierson_off[pierson_dates$waterYear==2017],color="#5D3A9B",size=1)+ # pierson ice-off
  geom_hline(yintercept=0.5,linetype=2)+
  labs(y = "Probability of No Ice"
  )+ lims(x = c(170,255))+
  theme_bw()+
  theme(axis.title.x = element_blank()) +
  scale_x_continuous(breaks=labels_x,labels=c("Mar-21","Mar-31","Apr-10","Apr-20","Apr-30","May-10","May-20","May-30","Jun-09"),limits=c(170,255))+
  annotate('rect', xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2017], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2017], ymin=-Inf, ymax=Inf, alpha=0.4, fill='lightblue')

probIcePlot

probTempCQPlot <- probIcePlot / outTempPlot_preddate / outCQPlot_preddate + plot_layout(heights = c(20,20,20))
probTempCQPlot
ggsave("Figures/probOutPlot2017.png", dpi=600, width=6, height=8, units="in")
```





# Plain Plots for supplemental slides:

```{r}
ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2018),
  aes(x = wy_doy, y = cumulative_dis, group = waterYear)) +
  theme_bw() +
  geom_line(size=1) +
  geom_point(aes(x = wy_doy, y = cumulative_dis, group = waterYear),size=1.5)+
  lims(x = c(209, 244), y = c(100, 750))+
  labs(x="Date", y = "Cumulative Discharge (cms)")+
  scale_y_continuous(breaks=labels_y_cq,labels=c("5","10","15","20"),limits=c(100,750))+
  scale_x_continuous(breaks=labels_x,labels=c("Apr-30","May-05","May-10","May-15","May-20", "May-25","May-30"),limits=c(209,244))+
  annotate('rect', xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2018], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2018], ymin=-Inf, ymax=Inf, alpha=0.4, fill='lightblue')
```


```{r}
ggplot(
  imputed_data_trimmed %>%
    filter(waterYear == 2023),
  aes(x = wy_doy, y = cumulative_dis, group = waterYear)) +
  theme_bw() +
  geom_line(size=1) +
  geom_point(aes(x = wy_doy, y = cumulative_dis, group = waterYear),size=1.5)+
  geom_vline(xintercept=hindcasted_dates$first_no_ice_wy_doy[hindcasted_dates$waterYear==2023],color="#E66100",size=1)+ # hindcasted ice-off
  lims(x = c(210, 255), y = c(50, 800))+
  theme(axis.title.x = element_blank())+
  labs(y = "Cumulative Discharge (cfs)")+
  annotate('rect', xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2023], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2023], ymin=-Inf, ymax=Inf, alpha=0.4, fill='lightblue')
```

```{r}
ggplot(
  flow_temp_cond_daily_ice %>%
    filter(waterYear == 2020),
  aes(x = wy_doy, y = Temperature_C, group = waterYear)) +
  theme_bw() +
  geom_line(size=1) +
  geom_point(aes(x = wy_doy, y = Temperature_C, group = waterYear),size=1.5)+
  geom_vline(xintercept=hindcasted_dates$first_no_ice_wy_doy[hindcasted_dates$waterYear==2020],color="#E66100",size=1)+ # hindcasted ice-off
  lims(x = c(189, 258), y = c(0, 10))+
  theme(axis.title.x = element_blank())+
  labs(y = "Temperature (C)")+
  annotate('rect', xmin=obs_ice_melt_windows$wy_doy_100_ice[obs_ice_melt_windows$waterYear == 2020], xmax=obs_ice_melt_windows$wy_doy_0_ice[obs_ice_melt_windows$waterYear == 2020], ymin=-Inf, ymax=Inf, alpha=0.4, fill='lightblue')
```

# ICE ON! PLOTS

```{r}
# Create a 'year' column for filtering

daily_data_trimmed_winter <- daily_data_trimmed_winter %>%
  mutate(year = year(Date),
         doy = yday(Date))

```
## WY 2014
```{r}
# water year 2014
WY2014_iceon_flow <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2013 & doy >=258),
  aes(x = doy, y = Flow, group = year)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2014], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,400))+
  labs(x = "Date", y = "Flow (cfs)", title="WY2014")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))

WY2014_iceon_cond <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2013 & doy >=258),
  aes(x = doy, y = cond_uScm, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2014], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Conductivity (uS/cm)", title="WY2014")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA)) 

WY2014_iceon_temp <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2013 & doy >=258),
  aes(x = doy, y = Temperature_C, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2014], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Temperature (°C)", title="WY2014")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))


WY2014_iceon_flow /
WY2014_iceon_cond /
WY2014_iceon_temp

ggsave("Figures/WY2014_iceon_flow_cond_temp.png", width=3, height=5, units="in",dpi=600)
```

## WY 2015
```{r}
# water year 2015
WY2015_iceon_flow <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2014 & doy >=258),
  aes(x = doy, y = Flow, group = year)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2015], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Flow (cfs)", title="WY2015")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))

WY2015_iceon_cond <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2014 & doy >=258),
  aes(x = doy, y = cond_uScm, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2015], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Conductivity (uS/cm)", title="WY2015")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA)) 

WY2015_iceon_temp <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2014 & doy >=258),
  aes(x = doy, y = Temperature_C, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2015], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Temperature (°C)", title="WY2015")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))


WY2015_iceon_flow /
WY2015_iceon_cond /
WY2015_iceon_temp

ggsave("Figures/WY2015_iceon_flow_cond_temp.png", width=3, height=5, units="in",dpi=600)
```

## WY 2016
```{r}
# water year 2016
WY2016_iceon_flow <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2015 & doy >=258),
  aes(x = doy, y = Flow, group = year)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2016], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Flow (cfs)", title="WY2016")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))

WY2016_iceon_cond <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2015 & doy >=258),
  aes(x = doy, y = cond_uScm, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2016], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Conductivity (uS/cm)", title="WY2016")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA)) 

WY2016_iceon_temp <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2015 & doy >=258),
  aes(x = doy, y = Temperature_C, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2016], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Temperature (°C)", title="WY2016")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))


WY2016_iceon_flow /
WY2016_iceon_cond /
WY2016_iceon_temp

ggsave("Figures/WY2016_iceon_flow_cond_temp.png", width=3, height=5, units="in",dpi=600)
```


## WY 2017
```{r}
# water year 2017
WY2017_iceon_flow <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2016 & doy >=258),
  aes(x = doy, y = Flow, group = year)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2017], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Flow (cfs)", title="WY2017")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))

WY2017_iceon_cond <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2016 & doy >=258),
  aes(x = doy, y = cond_uScm, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2017], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Conductivity (uS/cm)", title="WY2017")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA)) 

WY2017_iceon_temp <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2016 & doy >=258),
  aes(x = doy, y = Temperature_C, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2017], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Temperature (°C)", title="WY2017")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))


WY2017_iceon_flow /
WY2017_iceon_cond /
WY2017_iceon_temp

ggsave("Figures/WY2017_iceon_flow_cond_temp.png", width=3, height=5, units="in",dpi=600)
```



## WY 2018
```{r}
# water year 2018
WY2018_iceon_flow <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2017 & doy >=258),
  aes(x = doy, y = Flow, group = year)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2018], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Flow (cfs)", title="WY2018")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))

WY2018_iceon_cond <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2017 & doy >=258),
  aes(x = doy, y = cond_uScm, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2018], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Conductivity (uS/cm)", title="WY2018")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA)) 

WY2018_iceon_temp <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2017 & doy >=258),
  aes(x = doy, y = Temperature_C, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2018], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Temperature (°C)", title="WY2018")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))


WY2018_iceon_flow /
WY2018_iceon_cond /
WY2018_iceon_temp

ggsave("Figures/WY2018_iceon_flow_cond_temp.png", width=3, height=5, units="in",dpi=600)
```



## WY 2019
```{r}
# water year 2019
WY2019_iceon_flow <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2018 & doy >=258),
  aes(x = doy, y = Flow, group = year)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2019], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Flow (cfs)", title="WY2019")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))

WY2019_iceon_cond <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2018 & doy >=258),
  aes(x = doy, y = cond_uScm, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2019], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Conductivity (uS/cm)", title="WY2019")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA)) 

WY2019_iceon_temp <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2018 & doy >=258),
  aes(x = doy, y = Temperature_C, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2019], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Temperature (°C)", title="WY2019")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))


WY2019_iceon_flow /
WY2019_iceon_cond /
WY2019_iceon_temp

ggsave("Figures/WY2019_iceon_flow_cond_temp.png", width=3, height=5, units="in",dpi=600)
```




## WY 2020
```{r}
# water year 2020
WY2020_iceon_flow <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2019 & doy >=258),
  aes(x = doy, y = Flow, group = year)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2020], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Flow (cfs)", title="WY2020")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))

WY2020_iceon_cond <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2019 & doy >=258),
  aes(x = doy, y = cond_uScm, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2020], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Conductivity (uS/cm)", title="WY2020")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA)) 

WY2020_iceon_temp <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2019 & doy >=258),
  aes(x = doy, y = Temperature_C, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2020], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Temperature (°C)", title="WY2020")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))


WY2020_iceon_flow /
WY2020_iceon_cond /
WY2020_iceon_temp

ggsave("Figures/WY2020_iceon_flow_cond_temp.png", width=3, height=5, units="in",dpi=600)
```



## WY 2021
```{r}
# water year 2021
WY2021_iceon_flow <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2020 & doy >=258),
  aes(x = doy, y = Flow, group = year)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2021], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Flow (cfs)", title="WY2021")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))

WY2021_iceon_cond <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2020 & doy >=258),
  aes(x = doy, y = cond_uScm, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2021], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Conductivity (uS/cm)", title="WY2021")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA)) 

WY2021_iceon_temp <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2020 & doy >=258),
  aes(x = doy, y = Temperature_C, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2021], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Temperature (°C)", title="WY2021")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))


WY2021_iceon_flow /
WY2021_iceon_cond /
WY2021_iceon_temp

ggsave("Figures/WY2021_iceon_flow_cond_temp.png", width=3, height=5, units="in",dpi=600)
```



## WY 2022
```{r}
# water year 2022
WY2022_iceon_flow <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2021 & doy >=258),
  aes(x = doy, y = Flow, group = year)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2022], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Flow (cfs)", title="WY2022")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))

WY2022_iceon_cond <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2021 & doy >=258),
  aes(x = doy, y = cond_uScm, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2022], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Conductivity (uS/cm)", title="WY2022")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA)) 

WY2022_iceon_temp <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2021 & doy >=258),
  aes(x = doy, y = Temperature_C, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2022], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Temperature (°C)", title="WY2022")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))


WY2022_iceon_flow /
WY2022_iceon_cond /
WY2022_iceon_temp

ggsave("Figures/WY2022_iceon_flow_cond_temp.png", width=3, height=5, units="in",dpi=600)
```



## WY 2023
```{r}
# water year 2023
WY2023_iceon_flow <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2022 & doy >=258),
  aes(x = doy, y = Flow, group = year)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2023], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Flow (cfs)", title="WY2023")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))

WY2023_iceon_cond <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2022 & doy >=258),
  aes(x = doy, y = cond_uScm, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2023], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Conductivity (uS/cm)", title="WY2023")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA)) 

WY2023_iceon_temp <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2022 & doy >=258),
  aes(x = doy, y = Temperature_C, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2023], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Temperature (°C)", title="WY2023")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))


WY2023_iceon_flow /
WY2023_iceon_cond /
WY2023_iceon_temp

ggsave("Figures/WY2023_iceon_flow_cond_temp.png", width=3, height=5, units="in",dpi=600)
```


## WY 2024
```{r}
# water year 2024
WY2024_iceon_flow <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2023 & doy >=258),
  aes(x = doy, y = Flow, group = year)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2024], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Flow (cfs)", title="WY2024")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))

WY2024_iceon_cond <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2023 & doy >=258),
  aes(x = doy, y = cond_uScm, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2024], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Conductivity (uS/cm)", title="WY2024")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA)) 

WY2024_iceon_temp <- ggplot(
  daily_data_trimmed_winter %>%
    filter(year == 2023 & doy >=258),
  aes(x = doy, y = Temperature_C, group = waterYear)) +
  geom_vline(xintercept = obs_ice_on_dates$doy[obs_ice_on_dates$waterYear == 2024], color="forestgreen", size=1.5)+ # observed ice-on date
  theme_dark() +
  geom_line() +
  # lims(x = c(265,330))+
  labs(x = "Date", y = "Temperature (°C)", title="WY2024")+
  theme(panel.ontop=TRUE,panel.background = element_rect(fill = NA))


WY2024_iceon_flow /
WY2024_iceon_cond /
WY2024_iceon_temp

ggsave("Figures/WY2024_iceon_flow_cond_temp.png", width=3, height=5, units="in",dpi=600)
```


